(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["wxcomponents/hch-poster/hch-poster"],{2955:function(e,t,n){"use strict";n.r(t);var o=n("a23e"),a=n("3714");for(var i in a)"default"!==i&&function(e){n.d(t,e,function(){return a[e]})}(i);n("3908");var s,c=n("f0c5"),l=Object(c["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);t["default"]=l.exports},3714:function(e,t,n){"use strict";n.r(t);var o=n("f8d3"),a=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);t["default"]=a.a},3908:function(e,t,n){"use strict";var o=n("9a4c"),a=n.n(o);a.a},"9a4c":function(e,t,n){},a23e:function(e,t,n){"use strict";var o,a=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return o})},f8d3:function(e,t,n){"use strict";(function(e){function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{}},props:{canvasFlag:{type:Boolean,default:!0},posterObj:{type:Object,default:{url:"https://img0.zuipin.cn/mp_zuipin/poster/hch-pro.jpg",title:"诗酒茶系列 武夷大红袍 2018年 花香型中火 一级 体验装 16g",code:"https://img0.zuipin.cn/mp_zuipin/poster/hch-code.png"}}},methods:{roundRect:function(e,t,n,o,a,i,s,c,l){if(e.beginPath(),e.arc(t+i,n+i,i,Math.PI,1.5*Math.PI),e.moveTo(t+i,n),e.lineTo(t+o-i,n),e.arc(t+o-i,n+i,i,1.5*Math.PI,2*Math.PI),e.lineTo(t+o,n+a-i),e.arc(t+o-i,n+a-i,i,0,.5*Math.PI),e.arc(t+i,n+a-i,i,.5*Math.PI,Math.PI),e.lineTo(t,n+i),"btn"==l){var r=e.createLinearGradient(0,0,200,0);r.addColorStop(0,s),r.addColorStop(1,c),e.setFillStyle(r),e.fill()}else s&&(e.setFillStyle(s),e.fill()),c&&(e.setStrokeStyle(c),e.stroke());e.closePath(),e.clip()},canvasMultiLineText:function(e,t,n,o){for(var a=t.split(""),i="",s=[],c=0;c<a.length;c++)e.measureText(i).width<n?i+=a[c]:(c--,s.push(i),i="");if(s.push(i),s.length>o){for(var l=s.slice(0,o),r=l[1],h="",f=[],u=0;u<r.length;u++){if(!(e.measureText(h).width<n))break;h+=r[u]}f.push(h);var p=f[0]+"...";l.splice(o-1,1,p),s=l}return s},codeImg:function(){var t=this;return new Promise(function(o,a){request({method:"get",url:"/spSupport/getwxacodeunlimit",header:{"Content-Type":"application/x-www-form-urlencoded"},data:{version:t.$parent.globalData.version,scene:"sku=".concat(t.sku),page:"pages/product/detail",width:"128px"}}).then(function(t){if(0==t.data.code){var a=wx.getFileSystemManager(),i="tmp_img_src",s="".concat(wx.env.USER_DATA_PATH,"/").concat(i,".jpg");a.writeFile({filePath:s,data:t.data.data,encoding:"binary",success:function(){o(s)},fail:function(){this.canvasFlag=!0,e.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}})}else e.showToast(n({title:t.data.message,icon:"none",duration:2e3},"icon","none"))}).catch(function(){t.canvasFlag=!0,e.showToast({title:"海报生成失败",duration:2e3,icon:"none"})})})},createCanvasImage:function(){var t=this;console.log(this.posterObj,"posterObj"),console.log("海报生成中"),wx.showLoading({title:"海报生成中..."});var n=this,o=wx.getSystemInfoSync();this.phoneH=o.windowHeight,this.phoneW=o.windowWidth;this.phoneW;var a=this.phoneH/667;console.log(this.phoneH,this.phoneW);var i=wx.createCanvasContext("myCanvas"),s=this.posterObj.url,c=this.posterObj.code,l="https://imgzuipin.oss-cn-hangzhou.aliyuncs.com/mp_zuipin/poster/close_btn.png";console.log(i),console.log(this),i.draw(),i.save(),this.roundRect(i,50,40,this.phoneW-100,this.phoneH-170,10,"#fff","#fff"),i.restore(),i.save(),this.roundRect(i,50,40,this.phoneW-100,320*a,10,"#f7f7f7","#f7f7f7"),i.restore(),wx.getImageInfo({src:s,success:function(e){i.save(),n.roundRect(i,(n.phoneW-(n.phoneW-130))/2,55,n.phoneW-130,250*a,10,"#f7f7f7","#f7f7f7"),i.drawImage(e.path,(n.phoneW-(n.phoneW-130))/2,55,n.phoneW-130,250*a,10),i.restore(),i.draw(!0)},fail:function(){n.canvasFlag=!0,e.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),wx.getImageInfo({src:l,success:function(e){i.drawImage(e.path,n.phoneW-100+50+5,40,24,24),i.draw(!0)},fail:function(){n.canvasFlag=!0,e.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),setTimeout(function(){i.setGlobalAlpha(1),i.setFillStyle("#1c1c1c"),i.setFontSize(20),i.font="normal bold 14px sans-serif";for(var e=t.posterObj.title,n=t.canvasMultiLineText(i,e,t.phoneW-130,2),o=360,s=65,c=18,l=0;l<n.length;l++)i.fillText(n[l],s,(o+c*l-10)*a,t.phoneW-130),i.draw(!0)},500),wx.getImageInfo({src:c,success:function(e){i.drawImage(e.path,(n.phoneW-70)/2,380*a,70,70),i.draw(!0)},fail:function(){n.canvasFlag=!0,e.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),i.setFontSize(14),i.setFillStyle("#2f1709"),i.font="normal bold 14px sans-serif",i.fillText("小榔头记账",(n.phoneW-75)/2,480*a,100),i.setFontSize(14),i.setFillStyle("#ff5f33"),i.font="normal 14px sans-serif",i.fillText("长按/扫描识别小程序",(n.phoneW-140)/2,500*a,150),i.save(),this.roundRect(i,(this.phoneW-160)/2,this.phoneH-120,160,36,18,"#ff3600","#ff6a00","btn"),i.restore(),i.setFontSize(14),i.setFillStyle("#fff"),i.font="normal bold 14px sans-serif",i.fillText("保存图片",(n.phoneW-58)/2,this.phoneH-98,58),wx.hideLoading()},saveCanvasImage:function(){console.log("点击了保存"),wx.showLoading({title:"保存中..."});var t=this;e.canvasToTempFilePath({x:50,y:40,width:this.phoneW-100,height:this.phoneH-120,destWidth:5*(this.phoneW-100),destHeight:5*(this.phoneH-120),canvasId:"myCanvas",success:function(n){e.saveImageToPhotosAlbum({filePath:n.tempFilePath,success:function(n){wx.hideLoading(),e.showToast({title:"图片保存成功，可以去分享啦~",duration:2e3}),t.canvasCancelEvn()},fail:function(){e.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},fail:function(){e.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},canvasCancelEvn:function(){console.log(),this.$emit("cancel",!0)}}};t.default=o}).call(this,n("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'wxcomponents/hch-poster/hch-poster-create-component',
    {
        'wxcomponents/hch-poster/hch-poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("2955"))
        })
    },
    [['wxcomponents/hch-poster/hch-poster-create-component']]
]);
